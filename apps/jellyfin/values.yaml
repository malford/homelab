app-template:
  defaultPodOptions:
    enableServiceLinks: true
    securityContext:
      fsGroup: 100
  controllers:
    main:
      containers:
        jellyfin:
          image: { repository: docker.io/jellyfin/jellyfin, tag: 10.8.13 }
        plex:
          image: { repository: docker.io/plexinc/pms-docker, tag: 1.42.2.10156-f737b826c }
          env:
            HOSTNAME: "plex.malford.io"
            TZ: "America/New_York"
            PLEX_UID: "1027"
            PLEX_GID: "100"
            ALLOWED_NETWORKS: 192.168.0.0/16,10.0.0.0/8
        transmission:
          securityContext:
            capabilities:
              add: ["NET_ADMIN"]
          image: { repository: docker.io/haugene/transmission-openvpn, tag: 5.3.2 }
          env:
            OPENVPN_PROVIDER: custom
            OPENVPN_CONFIG: torguard-USA-NEW-YORK
            OPENVPN_USERNAME:
              valueFrom:
                secretKeyRef:
                  name: openvpn
                  key: OPENVPN_USERNAME
            OPENVPN_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: openvpn
                  key: OPENVPN_PASSWORD
            TRANSMISSION_DOWNLOAD_DIR: /media/downloads
            LOCAL_NETWORK: 192.168.0.0/16,10.0.0.0/8
        prowlarr:
          image: { repository: lscr.io/linuxserver/prowlarr, tag: 2.0.5 }
        radarr:
          image: { repository: docker.io/linuxserver/radarr, tag: 5.27.5 }
        sonarr:
          image: { repository: docker.io/linuxserver/sonarr, tag: 4.0.15 }
        jackett:
          image: { repository: docker.io/linuxserver/jackett, tag: 0.24.111 }
        sabnzbd:
          image: { repository: docker.io/linuxserver/sabnzbd, tag: 4.5.3 }
        jellyseerr:
          image: { repository: docker.io/fallenbagel/jellyseerr, tag: 2.7.3 }
  service:
    main:
      controller: main
      ports:
        http:
          port: 8096
          protocol: HTTP
        plex:
          port: 32400
          protocol: HTTP
        sabnzbd:
          port: 8080
          protocol: HTTP
        transmission:
          port: 9091
          protocol: HTTP
        jackett:
          port: 9117
          protocol: HTTP
        prowlarr:
          port: 9696
          protocol: HTTP
        radarr:
          port: 7878
          protocol: HTTP
        sonarr:
          port: 8989
          protocol: HTTP
        jellyseerr:
          port: 5055
          protocol: HTTP
  ingress:
    main:
      enabled: true
      className: nginx
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
      hosts:
        - host: &jellyfinHost jellyfin.malford.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: http
        - host: &plexHost plex.malford.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: plex
        - host: &transmissionHost transmission.malford.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: transmission
        - host: &prowlarrHost prowlarr.malford.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: prowlarr
        - host: &radarrHost radarr.malford.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: radarr
        - host: &sonarrHost sonarr.malford.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: sonarr
        - host: &jackettHost jackett.malford.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: jackett
        - host: &sabnzbdHost sabnzbd.malford.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: sabnzbd
        - host: &jellyseerrHost jellyseerr.malford.io
          paths:
            - path: /
              pathType: Prefix
              service:
                identifier: main
                port: jellyseerr
      tls:
        - secretName: jellyfin-tls-certificate
          hosts:
            - *jellyfinHost
            - *plexHost
            - *transmissionHost
            - *prowlarrHost
            - *radarrHost
            - *sonarrHost
            - *jackettHost
            - *sabnzbdHost
            - *jellyseerrHost
  persistence:
    media:
      type: persistentVolumeClaim
      existingClaim: jellyfin-media
      globalMounts:
        - path: /media
    config:
      enabled: true
      type: persistentVolumeClaim
      storageClass: standard-rwo
      accessMode: ReadWriteOnce
      size: 20Gi
      advancedMounts:
        main:
          jellyfin:
            - path: /config
              subPath: jellyfin
          transmission:
            - path: /config
              subPath: transmission-openvpn
          prowlarr:
            - path: /config
              subPath: prowlarr
          plex:
            - path: /config
              subPath: plex
          radarr:
            - path: /config
              subPath: radarr
          sonarr:
            - path: /config
              subPath: sonarr
          jackett:
            - path: /config
              subPath: Jackett
          sabnzbd:
            - path: /config
              subPath: sabnzbd
          jellyseerr:
            - path: /app/config
              subPath: jellyseerr
    openvpn:
      type: configMap
      name: jellyfin
      advancedMounts:
        main:
          transmission:
            - path: /etc/openvpn/custom
              readOnly: true

  configMaps:
    config:
      enabled: true
      data:
        torguard-USA-NEW-YORK.ovpn: |
          client
          dev tun
          proto udp
          remote us-ny.torguard.com 1912
          remote-cert-tls server
          auth SHA256
          key-direction 1
          setenv CLIENT_CERT 0
          <tls-auth>
          -----BEGIN OpenVPN Static key V1-----
          770e8de5fc56e0248cc7b5aab56be80d
          0e19cbf003c1b3ed68efbaf08613c3a1
          a019dac6a4b84f13a6198f73229ffc21
          fa512394e288f82aa2cf0180f01fb3eb
          1a71e00a077a20f6d7a83633f5b4f47f
          27e30617eaf8485dd8c722a8606d56b3
          c183f65da5d3c9001a8cbdb96c793d93
          6251098b24fe52a6dd2472e98cfccbc4
          66e63520d63ade7a0eacc36208c3142a
          1068236a52142fbb7b3ed83d785e12a2
          8261bccfb3bcb62a8d2f6d18f5df5f36
          52e59c5627d8d9c8f7877c4d7b08e19a
          5c363556ba68d392be78b75152dd55ba
          0f74d45089e84f77f4492d886524ea6c
          82b9f4dd83d46528d4f5c3b51cfeaf28
          38d938bd0597c426b0e440434f2c451f
          -----END OpenVPN Static key V1-----
          </tls-auth>
          nobind
          tls-version-min 1.2
          cipher AES-256-GCM
          auth-user-pass /config/openvpn-credentials.txt
          compress
          ncp-disable
          tun-mtu-extra 32
          <ca>
          -----BEGIN CERTIFICATE-----
          MIIDMTCCAhmgAwIBAgIJAKnGGJK6qLqSMA0GCSqGSIb3DQEBCwUAMBQxEjAQBgNV
          BAMMCVRHLVZQTi1DQTAgFw0xOTA1MjExNDIzMTFaGA8yMDU5MDUxMTE0MjMxMVow
          FDESMBAGA1UEAwwJVEctVlBOLUNBMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIB
          CgKCAQEAlv0UgPD3xVAvhhP6q1HCmeAWbH+9HPkyQ2P6qM5oHY5dntjmq8YT48FZ
          GHWv7+s9O47v6Bv7rEc4UwQx15cc2LByivX2JwmE8JACvNfwEnZXYAPq9WU3ZgRr
          AGvA09ItuLqK2fQ4A7h8bFhmyxCbSzP1sSIT/zJY6ebuh5rDQSMJRMaoI0t1zorE
          Z7PlEmh+o0w5GPs0D0vY50UcnEzB4GOdWC9pJREwEqppWYLN7RRdG8JyIqmA59mh
          ARCnQFUo38HWic4trxFe71jtD7YInNV7ShQtg0S0sXo36Rqfz72Jo08qqI70dNs5
          DN1aGNkQ/tRK9DhL5DLmTkaCw7mEFQIDAQABo4GDMIGAMB0GA1UdDgQWBBR7Dcym
          XBp6u/jAaZOPUjUhEyhXfjBEBgNVHSMEPTA7gBR7DcymXBp6u/jAaZOPUjUhEyhX
          fqEYpBYwFDESMBAGA1UEAwwJVEctVlBOLUNBggkAqcYYkrqoupIwDAYDVR0TBAUw
          AwEB/zALBgNVHQ8EBAMCAQYwDQYJKoZIhvcNAQELBQADggEBAE79ngbdSlP7IBbf
          nJ+2Ju7vqt9/GyhcsYtjibp6gsMUxKlD8HuvlSGj5kNO5wiwN7XXqsjYtJfdhmzz
          VbXksi8Fnbnfa8GhFl4IAjLJ5cxaWOxjr6wx2AhIs+BVVARjaU7iTK91RXJnl6u7
          UDHTkQylBTl7wgpMeG6GjhaHfcOL1t7D2w8x23cTO+p+n53P3cBq+9TiAUORdzXJ
          vbCxlPMDSDArsgBjC57W7dtdnZo7gTfQG77JTDFBeSwPwLF7PjBB4S6rzU/4fcYw
          y83XKP6zDn9tgUJDnpFb/7jJ/PbNkK4BWYJp3XytOtt66v9SEKw+v/fJ+VkjU16v
          E/9Q3h4=
          -----END CERTIFICATE-----
          -----BEGIN CERTIFICATE-----
          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
          -----END CERTIFICATE-----
          </ca>
          inactive 3600
          ping 10
          ping-exit 60
          resolv-retry 15
          verb 3
          remap-usr1 SIGTERM
          ; status success
